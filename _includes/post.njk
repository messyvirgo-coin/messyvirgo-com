<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} | Messy Virgo Coin (MESSY) Blog</title>
    <meta name="title" content="{{ title }} | Messy Virgo Coin (MESSY) Blog">
    <meta name="description" content="{{ description or 'Read this post on the MESSY blog' }}">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.messyvirgo.com/blog/{{ page.date | dateFilter }}/{{ title | slugify }}/">
    <meta property="og:title" content="{{ title }}">
    <meta property="og:description" content="{{ description or 'Read this post on the MESSY blog' }}">
    <meta property="og:image" content="https://www.messyvirgo.com/images/messy-banner.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.messyvirgo.com/blog/{{ page.date | dateFilter }}/{{ title | slugify }}/">
    <meta property="twitter:title" content="{{ title }}">
    <meta property="twitter:description" content="{{ description or 'Read this post on the MESSY blog' }}">
    <meta property="twitter:image" content="https://www.messyvirgo.com/images/messy-banner.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.messyvirgo.com/blog/{{ page.date | dateFilter }}/{{ title | slugify }}/">
    {% include "partials/head-common.njk" %}
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "{{ title }}",
        "description": "{{ description or 'Read this post on the MESSY blog' }}",
        "datePublished": "{{ page.date | htmlDateString }}",
        "author": {
            "@type": "Organization",
            "name": "Messy Virgo"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Messy Virgo",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.messyvirgo.com/images/messy-mascot.png"
            }
        }
    }
    </script>
</head>
<body class="blog-post-page flex flex-col min-h-screen">
    <div id="scroll-progress"></div>
    <div class="aurora-bg"></div>

    <!-- Navigation -->
    {% include "partials/nav.njk" %}

    <main class="max-w-3xl mx-auto px-4 py-16 md:py-24 flex-1">
        <!-- Post Header -->
        <article class="fade-in">
            <header class="mb-12 text-center">
                <h1 class="text-gradient text-4xl md:text-5xl font-bold font-serif mb-4">{{ title }}</h1>
                <div class="flex flex-col md:flex-row justify-center items-center gap-4 text-gray-400 text-sm">
                    <time datetime="{{ page.date | htmlDateString }}">{{ page.date | readableDate }}</time>
                </div>
            </header>

            <!-- Post Content -->
            <div class="prose prose-invert max-w-none mb-16 text-gray-300 leading-relaxed">
                {{ content | safe }}
            </div>

            <!-- Post Footer -->
            <div class="mt-16 pt-10">
                <a href="/blog/" class="inline-flex items-center read-more-btn">&larr; Back to Blog</a>
            </div>
        </article>
    </main>

    <!-- Footer -->
    {% set footerClass = 'mt-24' %}
    {% include "partials/footer.njk" %}

    <!-- External Scripts -->
    <script src="/js/main.js" defer></script>
    <!-- Mermaid (for ```mermaid fenced blocks in blog posts) -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js" defer></script>
    <style>
        /* Fix title spacing to prevent text clipping (descenders like 'g' being cut off) */
        .blog-post-page header h1 {
            line-height: 1.3;
            word-break: break-word;
            overflow-wrap: break-word;
            padding-top: 0.25em;
            padding-bottom: 0.25em;
            overflow: visible;
        }
        
        /* Ensure lists display properly in blog posts */
        .prose ul,
        .prose ol {
            display: block !important;
            list-style-type: disc !important;
            margin-left: 1.5rem !important;
            margin-bottom: 1.5rem !important;
            padding-left: 0 !important;
        }
        
        .prose ol {
            list-style-type: decimal !important;
        }
        
        .prose li {
            display: list-item !important;
            margin-bottom: 0.5rem !important;
            color: #d1d5db !important;
        }
        
        /* Ensure blockquotes display properly */
        .prose blockquote {
            display: block !important;
            border-left: 4px solid rgba(255, 105, 180, 0.5) !important;
            padding-left: 1.5rem !important;
            padding-top: 0.5rem !important;
            padding-bottom: 0.5rem !important;
            padding-right: 0 !important;
            font-style: italic !important;
            color: #d1d5db !important;
            margin-top: 1rem !important;
            margin-bottom: 1rem !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
        }
        
        /* Remove extra spacing from paragraphs inside blockquotes */
        .prose blockquote p {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }
        
        .prose blockquote p:first-child {
            margin-top: 0 !important;
        }
        
        .prose blockquote p:last-child {
            margin-bottom: 0 !important;
        }
        
        /* Hide empty paragraphs in blockquotes that create extra lines */
        .prose blockquote p:empty {
            display: none !important;
        }
        
        /* Ensure blog post content is always visible on all screen sizes */
        body.blog-post-page article.fade-in {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
        
        /* Back to Blog button style - matching read-more-btn */
        .read-more-btn {
            display: inline-block;
            position: relative;
            z-index: 1;
            padding: 0.5rem 1.25rem;
            background: rgba(255, 105, 180, 0.1);
            border: 1px solid rgba(255, 105, 180, 0.3);
            border-radius: 20px;
            color: #ff69b4;
            font-size: 0.8125rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .read-more-btn::after {
            display: none !important;
        }
        .read-more-btn:hover {
            background: rgba(255, 105, 180, 0.2);
            border-color: #ff69b4;
            transform: translateY(-1px);
            text-decoration: none;
            color: #ff69b4;
        }

        /* Mermaid diagram container styling */
        .prose .mermaid {
            background: rgba(17, 24, 39, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.10);
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-x: auto;
            margin: 1.25rem 0;
        }

        .prose .mermaid svg {
            max-width: 100%;
            height: auto;
        }
    </style>
    <script>
        // Add prose styling for markdown content
        document.addEventListener('DOMContentLoaded', () => {
            const proseContent = document.querySelector('.prose');
            if (proseContent) {
                // Style paragraphs - add spacing
                proseContent.querySelectorAll('p').forEach(paragraph => {
                    paragraph.classList.add('mb-6');
                });

                // Style headings with better spacing
                proseContent.querySelectorAll('h2, h3, h4, h5, h6').forEach(heading => {
                    heading.classList.add('text-gradient', 'font-serif', 'mb-4', 'mt-10');
                    if (heading.tagName === 'H2') {
                        heading.classList.add('text-2xl', 'md:text-3xl');
                        // More space before H2 headings
                        heading.classList.remove('mt-10');
                        heading.classList.add('mt-12');
                    }
                    if (heading.tagName === 'H3') heading.classList.add('text-xl', 'md:text-2xl');
                });

                // Style lists
                proseContent.querySelectorAll('ul, ol').forEach(list => {
                    list.classList.add('mb-6', 'pl-6');
                    // Ensure list style is visible
                    if (list.tagName === 'UL') {
                        list.style.listStyleType = 'disc';
                    } else if (list.tagName === 'OL') {
                        list.style.listStyleType = 'decimal';
                    }
                    list.style.listStylePosition = 'outside';
                    list.style.marginLeft = '1.5rem';
                });
                
                // Style list items
                proseContent.querySelectorAll('li').forEach(item => {
                    item.classList.add('mb-2', 'text-gray-300');
                    item.style.display = 'list-item';
                });

                // Style links
                proseContent.querySelectorAll('a').forEach(link => {
                    link.classList.add('text-pink-400', 'hover:text-pink-300', 'transition', 'underline');
                });

                // Style blockquotes (CSS handles most styling, just ensure classes)
                proseContent.querySelectorAll('blockquote').forEach(blockquote => {
                    // Remove any conflicting margin classes
                    blockquote.classList.remove('my-6');
                });

                // Style code blocks
                proseContent.querySelectorAll('pre').forEach(pre => {
                    pre.classList.add('bg-gray-900', 'border', 'border-gray-700', 'rounded', 'p-4', 'overflow-x-auto', 'my-4');
                });

                // Style inline code
                proseContent.querySelectorAll('code').forEach(code => {
                    if (code.parentElement && code.parentElement.tagName !== 'PRE') {
                        code.classList.add('bg-gray-900', 'text-pink-400', 'px-2', 'py-1', 'rounded', 'text-sm');
                    }
                });
            }
        });
    </script>
    <script>
        // Render Mermaid diagrams from fenced blocks:
        // ```mermaid
        // flowchart ...
        // ```
        document.addEventListener('DOMContentLoaded', () => {
            const prose = document.querySelector('.prose');
            if (!prose) return;

            // Convert <pre><code class="language-mermaid">…</code></pre> into <div class="mermaid">…</div>
            const mermaidCodeBlocks = prose.querySelectorAll('pre > code.language-mermaid, pre > code.mermaid');
            mermaidCodeBlocks.forEach((code) => {
                const pre = code.parentElement;
                if (!pre) return;

                const container = document.createElement('div');
                container.className = 'mermaid';
                container.textContent = code.textContent || '';
                pre.replaceWith(container);
            });

            // Initialize Mermaid (wait briefly in case the CDN script hasn't loaded yet)
            const tryInit = () => {
                if (!window.mermaid) return false;
                try {
                    window.mermaid.initialize({
                        startOnLoad: false,
                        theme: 'dark',
                        securityLevel: 'strict',
                    });
                    window.mermaid.run({ querySelector: '.prose .mermaid' });
                } catch (e) {
                    console.warn('Mermaid render failed:', e);
                }
                return true;
            };

            if (tryInit()) return;
            let attempts = 0;
            const timer = setInterval(() => {
                attempts += 1;
                if (tryInit() || attempts > 40) clearInterval(timer); // ~2s max
            }, 50);
        });
    </script>
</body>
</html>

